version: '3.8'

# Event Horizon - File sharing and clipboard sync
# Usage: docker compose up -d --build
# Access at https://localhost:9000 (accept self-signed certificate)

services:
  event-horizon:
    build: .
    container_name: event-horizon
    ports:
      - "9000:9000"
    environment:
      - NODE_ENV=production
      - PORT=9000
      - ENABLE_SSL=true
      # Security: File/clipboard expiry (customize as needed)
      - FILE_EXPIRY_MS=86400000      # 24 hours
      - CLIPBOARD_EXPIRY_MS=3600000  # 1 hour
      # Security: CORS origins (comma-separated, leave empty for all)
      # - CORS_ORIGINS=https://localhost:9000
    restart: unless-stopped
    # Security: Send SIGTERM for graceful shutdown (secure data wipe)
    stop_signal: SIGTERM
    stop_grace_period: 30s
    # Security: Memory limits to prevent DoS
    deploy:
      resources:
        limits:
          memory: 1G
    # Security: Drop all capabilities
    cap_drop:
      - ALL
    # Security: No new privileges
    security_opt:
      - no-new-privileges:true
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "--no-check-certificate", "https://127.0.0.1:9000/api/health"]
      interval: 30s
      timeout: 3s
      start_period: 10s
      retries: 3
